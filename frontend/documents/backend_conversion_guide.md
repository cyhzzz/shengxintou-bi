# 后端转化数据导入指南

## 📋 数据说明

**数据类型**: 后端转化明细数据
**数据级别**: 客户级别
**导入格式**: .xlsx, .xls, .csv
**数据来源**: 后端业务系统导出

---

## 🔍 如何获取数据

### 步骤 1: 登录公司“统一报表平台”

1. VPN
2. 使用您的账号登录统一报表平台[[统一报表平台（信创版）](https://rpt.swhysc.com/swhy/main)]
3. 进入省心投系统

### 步骤 2: 导出转化数据

1. 进入 **"4.线索明细"** 表
2. 设置筛选条件（务必选择全量数据，当前系统限制）
3. 申请**"导出"** 按钮
4. 申请通过后，尝试下载文件到本地

---

## ✅ 数据格式要求

### 必需字段（1个）

| 字段名 | 说明 | 格式要求 | 示例 |
|--------|------|----------|------|
| 线索日期 | 线索产生日期 | YYYY-MM-DD | 2025-01-15 |

### 完整字段列表（40个数据字段）

#### 基本信息（4个）

| 字段名 | 说明 | 格式要求 |
|--------|------|----------|
| 微信昵称 | 客户微信昵称 | 文本 |
| 资金账号 | 资金账号 | 文本 |
| 开户营业部 | 开户营业部 | 文本 |
| 客户性别 | 客户性别 | 文本 |

#### 平台和流量信息（3个）

| 字段名 | 说明 | 格式要求 |
|--------|------|----------|
| 平台来源 | 平台来源 | 文本（腾讯/抖音/小红书） |
| 流量类型 | 流量类型 | 文本 |
| 客户来源 | 客户来源 | 文本 |

#### 布尔字段（8个）

| 字段名 | 说明 | 支持的值 |
|--------|------|---------|
| 是否客户开口 | 是否客户主动开口 | 1/0, 是/否, Y/N, YES/NO |
| 是否有效线索 | 是否为有效线索 | 1/0, 是/否, Y/N, YES/NO |
| 是否开户中断 | 是否开户中断 | 1/0, 是/否, Y/N, YES/NO |
| 是否开户 | 是否已开户 | 1/0, 是/否, Y/N, YES/NO |
| 是否为有效户 | 是否为有效户 | 1/0, 是/否, Y/N, YES/NO |
| 是否为存量客户 | 是否为存量客户 | 1/0, 是/否, Y/N, YES/NO |
| 是否为存量有效户 | 是否为存量有效户 | 1/0, 是/否, Y/N, YES/NO |
| 是否删除企微 | 是否删除企微 | 1/0, 是/否, Y/N, YES/NO |

#### 时间字段（7个）

| 字段名 | 说明 | 格式要求 |
|--------|------|----------|
| 线索日期 | 线索产生日期 | YYYY-MM-DD（必需） |
| 开户中断日期 | 开户中断日期 | YYYY-MM-DD |
| 首次触达时间 | 首次触达时间 | YYYY-MM-DD HH:MM:SS |
| 最近互动时间 | 最近互动时间 | YYYY-MM-DD HH:MM:SS |
| 开户时间 | 开户时间 | YYYY-MM-DD HH:MM:SS |
| 微信认证时间 | 微信认证时间 | YYYY-MM-DD HH:MM:SS |
| 有效户时间 | 有效户时间 | YYYY-MM-DD HH:MM:SS |
| 广告点击日期 | 广告点击日期 | YYYY-MM-DD |

#### 数值字段（4个）

| 字段名 | 说明 | 格式要求 |
|--------|------|----------|
| 互动次数 | 互动次数 | 整数 |
| 营销人员互动次数 | 营销人员互动次数 | 整数 |
| 资产 | 资产金额 | 数值，保留2位小数 |
| 客户贡献 | 客户贡献 | 数值，保留2位小数 |

#### 人员信息（3个）

| 字段名 | 说明 | 格式要求 |
|--------|------|----------|
| 添加员工号 | 添加员工号 | 文本 |
| 添加员工姓名 | 添加员工姓名 | 文本 |
| 微信认证状态 | 微信认证状态 | 文本 |

#### 广告投放信息（4个）

| 字段名 | 说明 | 格式要求 |
|--------|------|----------|
| 广告账号 | 广告账号ID | 文本 |
| 广告代理商 | 广告代理商 | 文本 |
| 广告ID | 广告ID | 文本 |
| 创意ID | 创意ID | 文本 |

#### 小红书笔记信息（2个）

| 字段名 | 说明 | 格式要求 |
|--------|------|----------|
| 笔记ID | 小红书笔记ID | 文本 |
| 笔记名称 | 笔记标题 | 文本 |

#### 平台用户信息（2个）

| 字段名 | 说明 | 格式要求 |
|--------|------|----------|
| 平台用户ID | 平台用户ID | 文本 |
| 平台用户昵称 | 平台用户昵称 | 文本 |

#### 其他信息（2个）

| 字段名 | 说明 | 格式要求 |
|--------|------|----------|
| 生产者 | 生产者 | 文本 |
| 企微标签 | 企微标签 | 文本 |

### 字段映射说明

系统支持以下列名变体（自动识别）：

| 标准字段 | 支持的列名 |
|---------|-----------|
| 微信昵称 | 微信昵称, wechat_nickname |
| 资金账号 | 资金账号, capital_account |
| 开户营业部 | 开户营业部, opening_branch |
| 客户性别 | 客户性别, customer_gender |
| 平台来源 | 平台来源, platform_source |
| 流量类型 | 流量类型, traffic_type |
| 客户来源 | 客户来源, customer_source |
| 线索日期 | 线索日期, lead_date |
| 是否开户 | 是否开户, is_opened_account, is_open_account |
| 是否为有效户 | 是否为有效户, is_valid_customer, is_valid_client |
| 广告账号 | 广告账号, ad_account |
| 广告代理商 | 广告代理商, agency |
| 笔记ID | 笔记ID, note_id |
| 笔记名称 | 笔记名称, note_title |

---

## ⚠️ 注意事项

### 导入模式

- **全量覆盖**: 每次导入前删除所有旧数据
- 请确保导出文件包含完整的历史数据

### 数据要求

1. **日期格式**:
   - 日期字段: YYYY-MM-DD（如：2025-01-15）
   - 时间字段: YYYY-MM-DD HH:MM:SS（如：2025-01-15 10:30:00）

2. **布尔字段**:
   - 支持: 1/0, 是/否, Y/N, YES/NO
   - 不区分大小写

3. **数值字段**:
   - 互动次数: 整数
   - 资产、客户贡献: 数值，保留2位小数
   - 支持千分位格式（如：1,234.56）

4. **必填字段**:
   - ✅ 线索日期（唯一必需字段）
   - 其他字段可选（建议尽可能完整）

### 代理商映射

#### 抖音转化数据

- 使用 `广告代理商` 字段（拼音简称）
- 系统自动映射为全称（如：lz → 量子）
- 映射规则可在"简称管理"中配置

#### 腾讯转化数据

- 通过 `广告账号` 字段关联 `account_agency_mapping` 表
- 同时匹配日期（线索日期 == 投放日期）
- 自动获取代理商信息

#### 小红书转化数据

- 优先通过 `广告账号` 关联 `account_agency_mapping.account_name`
- 备用：使用简称映射（如果 `广告代理商` 字段有值）

### 常见问题

**Q: 为什么是全量覆盖？**
- 转化数据会更新（如客户从"未开户"变为"已开户"）
- 全量覆盖确保数据最新

**Q: 如何确保数据完整性？**
- 导入时确保包含所有历史数据
- 定期（如每周）全量导入一次
- 避免只导入增量数据

**Q: 布尔字段格式错误？**
- 系统支持多种格式：1/0, 是/否, Y/N, YES/NO
- 不区分大小写（yes/YES/Yes 都可以）

**Q: 导入后代理商为空？**
- 抖音：检查 `广告代理商` 字段是否为拼音简称
- 腾讯：检查 `广告账号` 是否在账号管理中配置
- 小红书：检查 `广告账号` 是否配置

---

## 📥 导入步骤

1. 在数据导入页面，选择 **"后端转化"** 数据类型
2. 点击上传区域或拖拽文件到上传框
3. 选择导出的文件（.xlsx, .xls 或 .csv）
4. 确认文件信息无误
5. 点击 **"开始导入"** 按钮
6. 等待导入完成（查看导入进度）
   - 导入时间取决于数据量（28,517行约40秒）

---

## 🔗 后续操作

### 数据验证

导入完成后，可在以下报表中验证：

1. **线索明细**: 查看所有转化数据
2. **转化漏斗**: 查看转化漏斗分析
3. **数据概览**: 查看核心转化指标
4. **厂商分析**: 按代理商维度查看转化数据

### 运行聚合脚本

如果需要更新聚合表（包含转化数据）：

```bash
# 更新最近30天的聚合数据
python backend/scripts/aggregations/update_daily_metrics_unified.py

# 更新指定日期范围
python backend/scripts/aggregations/update_daily_metrics_unified.py 2025-01-01 2025-01-15
```

---

## 💡 最佳实践

### 1. 数据导入频率

- **建议频率**: 每天一次或每周一次
- **更新时间**: 上午10点后（前一天的转化数据已更新）
- **导入模式**: 全量覆盖（每次导入所有历史数据）

### 2. 数据验证建议

导入后请验证：
- 总线索数是否与业务系统一致
- 各平台线索数是否正确
- 开户率、有效户率是否合理

### 3. 代理商简称配置

如果使用抖音转化数据，建议配置简称映射：

1. 进入 **配置管理** → **简称管理**
2. 添加代理商简称映射：
   - **简称**: lz
   - **全称**: 量子
   - **映射类型**: agency
3. 保存配置

---

## 📊 数据分析示例

### 转化漏斗分析

导入后可查看完整转化漏斗：

```
曝光 → 点击 → 线索 → 客户开口 → 有效线索 → 开户 → 有效户
```

### 代理商转化对比

按代理商维度对比：
- 线索数量
- 开户率（开户数 / 线索数）
- 有效户率（有效户数 / 开户数）
- 获客成本（花费 / 线索数）

### 平台转化对比

按平台维度对比：
- 腾讯 vs 抖音 vs 小红书
- 各平台转化率
- 各平台获客成本

---

## 📞 技术支持

如遇到问题，请联系：
- 技术支持: [邮箱/电话]
- 查看在线文档: [帮助文档链接]

---

**文档更新时间**: 2026-01-22
